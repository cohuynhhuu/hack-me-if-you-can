@page
@model Step4Model
@{
    ViewData["Title"] = "STEP 4: Authentication & Authorization";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2><i class="bi bi-4-circle-fill text-primary"></i> STEP 4: Authentication</h2>
                <a href="/" class="btn btn-outline-secondary"><i class="bi bi-house"></i> Dashboard</a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="demo-section vulnerable-section">
                <h4 class="text-danger"><i class="bi bi-exclamation-triangle-fill"></i> Vulnerable</h4>
                <p><strong>Problem:</strong> Plain text passwords, weak session tokens</p>
                <form onsubmit="testAuthVulnerable(event)">
                    <div class="mb-3">
                        <input type="text" class="form-control" placeholder="Username" id="vulnUser" required>
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control" placeholder="Password" id="vulnPass" required>
                    </div>
                    <button type="submit" class="btn btn-vulnerable w-100">
                        <i class="bi bi-bug-fill"></i> Login (Insecure)
                    </button>
                </form>
                <div id="vulnAuthResult" class="result-panel"></div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="demo-section secure-section">
                <h4 class="text-success"><i class="bi bi-shield-check-fill"></i> Secure</h4>
                <p><strong>Solution:</strong> BCrypt hashing + JWT tokens</p>
                <form onsubmit="testAuthSecure(event)">
                    <div class="mb-3">
                        <input type="text" class="form-control" placeholder="Username" id="secureUser" required>
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control" placeholder="Password" id="securePass" required>
                    </div>
                    <button type="submit" class="btn btn-secure w-100">
                        <i class="bi bi-shield-fill"></i> Login (Secure)
                    </button>
                </form>
                <div id="secureAuthResult" class="result-panel"></div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="highlight-box highlight-info">
                <h5><i class="bi bi-info-circle-fill"></i> Auth Best Practices</h5>
                <ul class="mb-0">
                    <li>BCrypt/Argon2 for password hashing (not MD5/SHA1)</li>
                    <li>JWT tokens with strong secrets and expiration</li>
                    <li>Multi-factor authentication (MFA)</li>
                    <li>Secure session management</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    async function testAuthVulnerable(e) {
        e.preventDefault();
        showResult('vulnAuthResult', 'warning', 'Password stored in plain text - easily compromised!');
    }

    async function testAuthSecure(e) {
        e.preventDefault();
        const username = document.getElementById('secureUser').value;
        const password = document.getElementById('securePass').value;
        
        const result = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        }).then(r => r.json()).catch(e => ({ error: e.message }));
        
        if (result.token) {
            showResult('secureAuthResult', 'success', 'Secure login successful!', result);
        } else {
            showResult('secureAuthResult', 'error', 'Login failed', result);
        }
    }
</script>
}
