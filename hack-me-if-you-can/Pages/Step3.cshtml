@page
@model Step3Model
@{
    ViewData["Title"] = "STEP 3: CSRF Protection";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2><i class="bi bi-3-circle-fill text-info"></i> STEP 3: CSRF Protection</h2>
                <a href="/" class="btn btn-outline-secondary"><i class="bi bi-house"></i> Dashboard</a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="demo-section vulnerable-section">
                <h4 class="text-danger"><i class="bi bi-exclamation-triangle-fill"></i> Vulnerable</h4>
                <p><strong>Problem:</strong> No anti-forgery token validation</p>
                <form onsubmit="testCSRFVulnerable(event)">
                    <div class="mb-3">
                        <input type="email" class="form-control" placeholder="Email" required>
                    </div>
                    <button type="submit" class="btn btn-vulnerable w-100">
                        <i class="bi bi-bug-fill"></i> Submit (No Token)
                    </button>
                </form>
                <div id="vulnCSRFResult" class="result-panel"></div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="demo-section secure-section">
                <h4 class="text-success"><i class="bi bi-shield-check-fill"></i> Secure</h4>
                <p><strong>Solution:</strong> Anti-forgery tokens (ValidateAntiForgeryToken)</p>
                <form onsubmit="testCSRFSecure(event)">
                    <input type="hidden" name="__RequestVerificationToken" value="DEMO_TOKEN_ABC123">
                    <div class="mb-3">
                        <input type="email" class="form-control" placeholder="Email" required>
                    </div>
                    <button type="submit" class="btn btn-secure w-100">
                        <i class="bi bi-shield-fill"></i> Submit (With Token)
                    </button>
                </form>
                <div id="secureCSRFResult" class="result-panel"></div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="highlight-box highlight-info">
                <h5><i class="bi bi-info-circle-fill"></i> CSRF Defenses</h5>
                <ul class="mb-0">
                    <li>[ValidateAntiForgeryToken] attribute on controller actions</li>
                    <li>@Html.AntiForgeryToken() in forms</li>
                    <li>SameSite cookie attribute</li>
                    <li>Custom request headers for AJAX</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    function testCSRFVulnerable(e) {
        e.preventDefault();
        showResult('vulnCSRFResult', 'error', 'Request accepted without token - vulnerable to CSRF!');
    }

    function testCSRFSecure(e) {
        e.preventDefault();
        showResult('secureCSRFResult', 'success', 'Token validated - CSRF attack prevented');
    }
</script>
}
