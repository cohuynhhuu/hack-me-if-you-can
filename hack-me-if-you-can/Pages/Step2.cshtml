@page
@model Step2Model
@{
    ViewData["Title"] = "STEP 2: XSS Protection";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2><i class="bi bi-2-circle-fill text-warning"></i> STEP 2: XSS Protection</h2>
                <a href="/" class="btn btn-outline-secondary"><i class="bi bi-house"></i> Dashboard</a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="demo-section vulnerable-section">
                <h4 class="text-danger"><i class="bi bi-exclamation-triangle-fill"></i> Vulnerable</h4>
                <p><strong>Problem:</strong> Unescaped user input rendered in HTML</p>
                <div class="mb-3">
                    <label class="form-label">Comment (Try: <code>&lt;script&gt;alert("XSS")&lt;/script&gt;</code>)</label>
                    <textarea class="form-control" id="vulnComment" rows="3"></textarea>
                </div>
                <button class="btn btn-vulnerable w-100" onclick="testXSSVulnerable()">
                    <i class="bi bi-bug-fill"></i> Test Vulnerable
                </button>
                <div id="vulnXSSResult" class="result-panel"></div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="demo-section secure-section">
                <h4 class="text-success"><i class="bi bi-shield-check-fill"></i> Secure</h4>
                <p><strong>Solution:</strong> Automatic HTML encoding + CSP headers</p>
                <div class="mb-3">
                    <label class="form-label">Comment (Same input - sanitized)</label>
                    <textarea class="form-control" id="secureComment" rows="3"></textarea>
                </div>
                <button class="btn btn-secure w-100" onclick="testXSSSecure()">
                    <i class="bi bi-shield-fill"></i> Test Secure
                </button>
                <div id="secureXSSResult" class="result-panel"></div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="highlight-box highlight-info">
                <h5><i class="bi bi-info-circle-fill"></i> XSS Defense Layers</h5>
                <ul class="mb-0">
                    <li>Automatic HTML encoding (ASP.NET Core default)</li>
                    <li>Content Security Policy (CSP) headers</li>
                    <li>Input validation and sanitization</li>
                    <li>HttpOnly and Secure cookie flags</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    function testXSSVulnerable() {
        const comment = document.getElementById('vulnComment').value;
        document.getElementById('vulnXSSResult').innerHTML = 
            `<strong>RAW OUTPUT:</strong><br>${comment}`;
        document.getElementById('vulnXSSResult').className = 'result-panel result-warning';
        document.getElementById('vulnXSSResult').style.display = 'block';
    }

    function testXSSSecure() {
        const comment = document.getElementById('secureComment').value;
        const escaped = escapeHtml(comment);
        document.getElementById('secureXSSResult').innerHTML = 
            `<strong>ESCAPED OUTPUT:</strong><br>${escaped}`;
        document.getElementById('secureXSSResult').className = 'result-panel result-success';
        document.getElementById('secureXSSResult').style.display = 'block';
    }
</script>
}
